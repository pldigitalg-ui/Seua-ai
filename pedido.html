<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pedido — Impressão</title>
  <style>
    body{ font-family: Arial, sans-serif; margin: 18px; color:#111; }
    h1{ margin:0 0 8px; font-size: 18px; }
    .muted{ color:#555; font-size: 12px; }
    .box{ border:1px solid #ddd; border-radius:12px; padding:12px; margin-top:12px; }
    .row{ display:flex; justify-content:space-between; gap:10px; }
    .items{ margin-top:10px; }
    .item{ padding:10px 0; border-top:1px dashed #ddd; }
    .item:first-child{ border-top:0; }
    .item strong{ display:block; }
    .tot{ margin-top:10px; border-top:2px solid #111; padding-top:10px; }
    .btn{ margin-top:12px; padding:10px 12px; border-radius:10px; border:1px solid #111; background:#fff; cursor:pointer; }
    @media print{
      .no-print{ display:none; }
      body{ margin:0; }
    }
  </style>
</head>
<body>
  <h1 id="ttl">Pedido</h1>
  <div class="muted" id="meta"></div>

  <div class="box" id="client"></div>
  <div class="box">
    <div class="items" id="items"></div>
    <div class="tot" id="totals"></div>
  </div>

  <button class="btn no-print" onclick="window.print()">Imprimir</button>

  <script>
    const raw = localStorage.getItem("lpgrill_last_order_print_v1");
    if (!raw){
      document.body.innerHTML = "<p>Nenhum pedido encontrado para impressão.</p>";
    } else {
      const data = JSON.parse(raw);
      const money = (v)=> new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(v||0);

      document.getElementById("ttl").textContent = `Pedido — ${data.brand || "LP Grill"}`;
      document.getElementById("meta").textContent = `Gerado em: ${new Date(data.createdAt || Date.now()).toLocaleString("pt-BR")}`;

      const c = [];
      if (data.name) c.push(`<div><strong>Nome:</strong> ${data.name}</div>`);
      if (data.phone) c.push(`<div><strong>Telefone:</strong> ${data.phone}</div>`);
      if (data.address) c.push(`<div><strong>Endereço/Retirada:</strong> ${data.address}</div>`);
      if (data.notes) c.push(`<div><strong>Obs:</strong> ${data.notes}</div>`);
      document.getElementById("client").innerHTML = c.length ? c.join("") : "<div class='muted'>Sem dados do cliente.</div>";

      document.getElementById("items").innerHTML = (data.items || []).map(it => `
        <div class="item">
          <strong>${it.qty}x ${it.name}</strong>
          <div class="muted">${it.desc || ""}</div>
          <div>${money((it.qty||0) * (it.price||0))}</div>
        </div>
      `).join("");

      document.getElementById("totals").innerHTML = `
        <div class="row"><span>Subtotal</span><strong>${money(data.subtotal)}</strong></div>
        <div class="row"><span>Entrega</span><strong>${money(data.fee)}</strong></div>
        <div class="row"><span>Total</span><strong>${money(data.total)}</strong></div>
      `;

      // auto print opcional:
      setTimeout(()=>window.print(), 350);
    }
  </script>
</body>
</html>
