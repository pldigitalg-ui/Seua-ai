<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>LP Grill — Pedido</title>
  <link rel="stylesheet" href="css/estilo.css" />
  <style>
    .print-wrap{ max-width: 820px; margin: 0 auto; padding: 18px; }
    .paper{
      background: rgba(255,255,255,.96);
      border: 1px solid rgba(11,11,18,.10);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .row{ display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .small{ font-size:12px; color: rgba(11,11,18,.70); font-weight: 800; }
    .items{ margin-top: 12px; display:flex; flex-direction:column; gap:10px; }
    .it{ border:1px solid rgba(11,11,18,.08); border-radius: 16px; padding: 12px; background:#fff; }
    .it b{ font-weight: 980; }
    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px; }
    @media print{
      .actions{ display:none; }
      body{ background:#fff; }
      .paper{ box-shadow:none; }
    }
  </style>
</head>
<body>

<div class="print-wrap">
  <div class="paper">
    <div class="row">
      <div>
        <h2 style="margin:0; font-size:18px; font-weight:980;">Comprovante do Pedido</h2>
        <div class="small" id="brandLine"></div>
      </div>
      <div class="small" id="dateLine"></div>
    </div>

    <div style="margin-top:12px;">
      <div class="small"><b>Cliente</b></div>
      <div id="custLine" style="font-weight:900;"></div>
      <div id="addrLine" class="small"></div>
      <div id="notesLine" class="small"></div>
    </div>

    <div class="items" id="items"></div>

    <div style="margin-top:14px; border-top:1px solid rgba(11,11,18,.10); padding-top:12px;">
      <div class="row">
        <div class="small">Subtotal</div>
        <div style="font-weight:980;" id="subtotal"></div>
      </div>
      <div class="row" id="feeRow" style="margin-top:6px; display:none;">
        <div class="small">Entrega</div>
        <div style="font-weight:980;" id="fee"></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <div style="font-weight:980;">Total</div>
        <div style="font-weight:980;" id="total"></div>
      </div>
    </div>

    <div class="actions">
      <button class="btn btn-chrome" type="button" onclick="window.print()">Imprimir</button>
      <a class="btn btn-outline" href="index.html">Voltar</a>
    </div>
  </div>
</div>

<script>
(function(){
  function money(v){
    try { return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(v); }
    catch { return `R$ ${Number(v||0).toFixed(2)}`.replace(".",","); }
  }

  let payload = null;
  try { payload = JSON.parse(localStorage.getItem("lpgrill_last_order_print_v1") || "null"); } catch { payload=null; }

  const brandLine = document.getElementById("brandLine");
  const dateLine  = document.getElementById("dateLine");
  const custLine  = document.getElementById("custLine");
  const addrLine  = document.getElementById("addrLine");
  const notesLine = document.getElementById("notesLine");
  const itemsBox  = document.getElementById("items");

  if (!payload){
    brandLine.textContent = "Nenhum pedido encontrado.";
    return;
  }

  brandLine.textContent = payload.brand || "LP Grill";
  dateLine.textContent  = new Date(payload.createdAt || Date.now()).toLocaleString("pt-BR");

  custLine.textContent = (payload.name || "") + (payload.phone ? " • " + payload.phone : "");
  addrLine.textContent = payload.address ? ("Endereço/Retirada: " + payload.address) : "";
  notesLine.textContent = payload.notes ? ("Obs: " + payload.notes) : "";

  itemsBox.innerHTML = (payload.items || []).map(it => {
    const totalIt = (it.qty || 0) * (it.price || 0);
    return `
      <div class="it">
        <div class="row">
          <div><b>${it.qty}x</b> ${it.name}</div>
          <div><b>${money(totalIt)}</b></div>
        </div>
        ${it.desc ? `<div class="small" style="margin-top:6px;">${it.desc}</div>` : ``}
      </div>
    `;
  }).join("");

  document.getElementById("subtotal").textContent = money(payload.subtotal || 0);

  const fee = Number(payload.fee || 0);
  if (fee > 0){
    document.getElementById("feeRow").style.display = "flex";
    document.getElementById("fee").textContent = money(fee);
  }

  document.getElementById("total").textContent = money(payload.total || ((payload.subtotal||0) + fee));
})();
</script>
</body>
</html>
